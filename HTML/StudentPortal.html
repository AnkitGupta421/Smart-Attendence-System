<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        .icon-bg-blue {
            background-color: #eef2ff;
        }

        .icon-bg-green {
            background-color: #e6f7f0;
        }

        .icon-bg-yellow {
            background-color: #fffbeb;
        }

        .icon-bg-red {
            background-color: #fef2f2;
        }

        .icon-bg-purple {
            background-color: #f3eefc;
        }

        /* Style for the video feed */
        #video {
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            max-width: 100%;
            height: auto;
        }

        /* Style for the captured image placeholder */
        #captured-image {
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
        }

        /* Custom style for displaying info - RESOLVED ERROR */
        .info-label {
            display: block;
            font-size: 0.875rem;
            /* 14px */
            font-weight: 800;
            color: #374151;
        }

        .info-data {
            margin-top: 0.25rem;
            /* 4px */
            font-size: 0.875rem;
            /* 14px */
            color: #111827;
            font-weight: 600;
            background-color: #f9fafb;
            padding-top: 0.5rem;
            /* 8px */
            padding-bottom: 0.5rem;
            /* 8px */
            padding-left: 0.75rem;
            /* 12px */
            padding-right: 0.75rem;
            /* 12px */
            border-radius: 0.375rem;
            /* 6px */
            border: 1px solid #e5e7eb;
        }
    </style>
</head>

<body class="bg-gray-100">

    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-user-check text-2xl text-indigo-600"></i>
                    <span class="text-2xl font-bold text-gray-800">Attendify</span>
                </div>

                <div class="flex items-center space-x-6">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="text-gray-700 font-medium">24BSA10200</span>
                    </div>
                    <button id="logout-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <section class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
            <div class="flex items-center">
                <div class="bg-indigo-600 p-4 rounded-lg flex items-center justify-center h-20 w-20">
                    <i class="fas fa-user-graduate text-4xl text-white"></i>
                </div>
                <div class="ml-4">
                    <h1 class="text-3xl font-bold text-gray-900">Welcome, Ankit</h1>
                    <p class="text-gray-500">Student Portal Dashboard</p>
                </div>
            </div>
            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 mt-4 md:mt-0 flex items-center">
                <svg class="w-8 h-8 text-indigo-500 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <div>
                    <p class="font-semibold text-indigo-800">Ankit Gupta</p>
                    <p class="text-sm text-indigo-600">B.tech (Cloud Computing)â€¢ 2nd Year</p>
                </div>
            </div>
        </section>

        <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center justify-between">
                <div>
                    <p class="text-gray-500">Total Classes</p>
                    <p id="total-classes-dashboard" class="text-3xl font-bold text-gray-900">--</p>
                </div>
                <div class="icon-bg-green p-3 rounded-lg">
                    <i class="fas fa-book-open text-2xl text-green-500"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center justify-between">
                <div>
                    <p class="text-gray-500">Present</p>
                    <p id="present-dashboard" class="text-3xl font-bold text-gray-900">--</p>
                </div>
                <div class="icon-bg-blue p-3 rounded-lg">
                    <i class="fas fa-check-circle text-2xl text-blue-500"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center justify-between">
                <div>
                    <p class="text-gray-500">Absent</p>
                    <p id="absent-dashboard" class="text-3xl font-bold text-gray-900">--</p>
                </div>
                <div class="icon-bg-red p-3 rounded-lg">
                    <i class="fas fa-times-circle text-2xl text-red-500"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm flex items-center justify-between">
                <div>
                    <p class="text-gray-500">Attendance Rate</p>
                    <p id="rate-dashboard" class="text-3xl font-bold text-gray-900">--</p>
                </div>
                <div class="icon-bg-purple p-3 rounded-lg">
                    <i class="fas fa-chart-line text-2xl text-purple-500"></i>
                </div>
            </div>
        </section>

        <div class="bg-white rounded-lg shadow-sm">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                    <a href="#" id="studentInfoTab"
                        class="border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Student Info
                    </a>
                    <a href="#" id="attendanceTab"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Attendance
                    </a>
                    <a href="#" id="imageUploadTab"
                        class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Image Upload
                    </a>
                </nav>
            </div>

            <div id="studentInfoContent" class="p-6">
                <div class="flex items-start">
                    <div class="bg-gray-100 p-3 rounded-full">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-lg font-semibold text-gray-900">Student Information</h2>
                        <p class="text-gray-500">Your personal and academic information from our records.</p>
                    </div>
                </div>

                <div class="mt-8">
                    <h3 class="text-base font-semibold text-gray-800 flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Personal Information
                    </h3>
                    <dl class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div class="sm:col-span-1">
                            <dt class="info-label">Registration No.</dt>
                            <dd class="info-data">12345</dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="info-label">Email Address</dt>
                            <dd class="info-data">alex.doe@university.edu</dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="info-label">First Name</dt>
                            <dd class="info-data">Alex</dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="info-label">Last Name</dt>
                            <dd class="info-data">Doe</dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="info-label">Phone Number</dt>
                            <dd class="info-data">+1 234-567-890</dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="info-label">Date of Birth</dt>
                            <dd class="info-data">15-08-2004</dd>
                        </div>
                        <div class="sm:col-span-2">
                            <dt class="info-label">Address</dt>
                            <dd class="info-data">123 University Lane, Campus City, State 12345</dd>
                        </div>
                    </dl>
                </div>

                <div class="mt-10">
                    <h3 class="text-base font-semibold text-gray-800 flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6.253v11.494m-9-5.747h18"></path>
                            <path d="M12 14l9-5-9-5-9 5 9 5z"></path>
                        </svg>
                        Academic Information
                    </h3>
                    <dl class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div class="sm:col-span-1">
                            <dt class="info-label">Department</dt>
                            <dd class="info-data">Computer Science</dd>
                        </div>
                        <div class="sm:col-span-1">
                            <dt class="info-label">Academic Year</dt>
                            <dd class="info-data">2nd Year</dd>
                        </div>
                        <div class="sm:col-span-2">
                            <dt class="info-label">Course/Program</dt>
                            <dd class="info-data">Bachelor of Technology (B.Tech)</dd>
                        </div>
                    </dl>
                </div>
            </div>


            <div id="attendanceContent" class="p-6 hidden">
                <div id="semester-view">
                    <h2 class="text-lg font-semibold text-gray-900">Attendance Details</h2>
                    <p class="text-gray-500 mt-2">Select a semester to view your subjects and overall summary.</p>

                    <div class="mt-6">
                        <label for="semester-select" class="block text-sm font-medium text-gray-700">Select your
                            Semester</label>
                        <select id="semester-select" name="semester-select"
                            class="mt-1 block w-full md:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="">-- Please choose a semester --</option>
                            <option value="sem1">Semester 1</option>
                            <option value="sem2">Semester 2</option>
                            <option value="sem3">Semester 3</option>
                        </select>
                    </div>

                    <div id="subject-list-container" class="mt-6 hidden">
                        <h3 class="text-md font-semibold text-gray-800">Your Subjects:</h3>
                        <div id="subject-list" class="mt-2 space-y-2">
                        </div>
                    </div>
                </div>

                <div id="subject-detail-view" class="hidden">
                    <button id="back-to-subjects"
                        class="text-sm font-medium text-indigo-600 hover:text-indigo-800 mb-4">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Subjects
                    </button>
                    <h2 id="subject-title" class="text-xl font-bold text-gray-900"></h2>
                    <p class="text-gray-500 mt-1">Your attendance summary for this subject.</p>

                    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total Classes</p>
                                <p id="total-classes" class="text-2xl font-bold text-gray-900"></p>
                            </div>
                            <div class="p-3 rounded-lg bg-green-100">
                                <i class="fas fa-book-open text-xl text-green-600"></i>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Present</p>
                                <p id="present-classes" class="text-2xl font-bold text-gray-900"></p>
                            </div>
                            <div class="p-3 rounded-lg bg-blue-100">
                                <i class="fas fa-check-circle text-xl text-blue-600"></i>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Absent</p>
                                <p id="absent-classes" class="text-2xl font-bold text-gray-900"></p>
                            </div>
                            <div class="p-3 rounded-lg bg-red-100">
                                <i class="fas fa-times-circle text-xl text-red-600"></i>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Attendance Rate</p>
                                <p id="attendance-rate" class="text-2xl font-bold text-gray-900"></p>
                            </div>
                            <div class="p-3 rounded-lg bg-purple-100">
                                <i class="fas fa-chart-line text-xl text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="imageUploadContent" class="p-6 hidden">
                <div class="flex items-start mb-6">
                    <div class="bg-gray-100 p-3 rounded-full">
                        <i class="fas fa-camera-retro w-6 h-6 text-gray-600"></i>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-lg font-semibold text-gray-900">Upload Your Face by Camera</h2>
                        <p class="text-gray-500">Use your camera to take a profile photo for attendance verification.
                        </p>
                    </div>
                </div>

                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6 rounded-r-lg">
                    <h3 class="font-bold text-blue-800">Please follow these instructions:</h3>
                    <ul class="mt-2 list-disc list-inside text-blue-700 space-y-1">
                        <li>Photo should be taken without spectacles or hats.</li>
                        <li>Ensure no other person is visible in the background.</li>
                        <li>Your face should be clearly visible with appropriate lighting.</li>
                        <li>You can only upload your photo in one chance.</li>
                    </ul>
                </div>

                <div id="upload-container" class="mt-6 space-y-4">
                    <div id="photo-buttons"
                        class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 space-y-4 sm:space-y-0">
                        <button id="start-camera" type="button"
                            class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fas fa-camera mr-2"></i> Start Camera
                        </button>
                        <button id="take-photo" type="button" disabled
                            class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-crosshairs mr-2"></i> Take Photo
                        </button>
                    </div>

                    <p id="camera-status" class="text-sm text-red-600"></p>

                    <div id="photo-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                        <div id="live-feed-container">
                            <h3 class="font-medium text-gray-700 mb-2">Live Camera Feed</h3>
                            <video id="video" autoplay class="bg-gray-200"></video>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-700 mb-2">Captured Photo</h3>
                            <canvas id="canvas" class="hidden"></canvas>
                            <img id="captured-image" src="https://placehold.co/600x400/e2e8f0/4a5568?text=Your+Photo"
                                alt="Your captured photo will appear here." class="w-full h-auto">
                        </div>
                    </div>
                </div>
                <div id="success-message"
                    class="hidden mt-6 text-center p-6 bg-green-50 border border-green-200 rounded-lg">
                    <i class="fas fa-check-circle text-4xl text-green-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-green-800">Photo Uploaded Successfully!</h3>
                    <p class="text-green-600 mt-1">You can no longer change your profile photo.</p>
                </div>
            </div>

        </div>
    </main>
    <script>
        // --- AWS Cognito Configuration & Logout Functionality Added Here ---
        const COGNITO_DOMAIN = 'https://ap-south-1gdypzg5zm.auth.ap-south-1.amazoncognito.com';
        const CLIENT_ID = '6q2v093o4igcsnc6khak9bc2vq';
        const LOGOUT_URI = 'http://localhost:8000/loginpage1.html';
        
        function performLogout() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                const logoutUrl = `${COGNITO_DOMAIN}/logout?client_id=${CLIENT_ID}&logout_uri=${encodeURIComponent(LOGOUT_URI)}`;
                window.location.href = logoutUrl;
                
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = LOGOUT_URI;
            }
        }
        
        document.getElementById('logout-btn').addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                performLogout();
            }
        });


        // --- Tab Switching Logic ---
        const studentInfoTab = document.getElementById('studentInfoTab');
        const attendanceTab = document.getElementById('attendanceTab');
        const imageUploadTab = document.getElementById('imageUploadTab');

        const studentInfoContent = document.getElementById('studentInfoContent');
        const attendanceContent = document.getElementById('attendanceContent');
        const imageUploadContent = document.getElementById('imageUploadContent');

        function switchTab(activeTab, inactiveTab1, inactiveTab2, activeContent, inactiveContent1, inactiveContent2) {
            activeTab.classList.add('border-indigo-500', 'text-indigo-600');
            activeTab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

            [inactiveTab1, inactiveTab2].forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            });

            activeContent.classList.remove('hidden');
            inactiveContent1.classList.add('hidden');
            inactiveContent2.classList.add('hidden');

            // By default show semester view when switching to attendance tab
            if (activeTab === attendanceTab) {
                document.getElementById('semester-view').classList.remove('hidden');
                document.getElementById('subject-detail-view').classList.add('hidden');
            }
        }

        studentInfoTab.addEventListener('click', (e) => {
            e.preventDefault();
            switchTab(studentInfoTab, attendanceTab, imageUploadTab, studentInfoContent, attendanceContent, imageUploadContent);
        });

        attendanceTab.addEventListener('click', (e) => {
            e.preventDefault();
            switchTab(attendanceTab, studentInfoTab, imageUploadTab, attendanceContent, studentInfoContent, imageUploadContent);
        });

        imageUploadTab.addEventListener('click', (e) => {
            e.preventDefault();
            switchTab(imageUploadTab, studentInfoTab, attendanceTab, imageUploadContent, studentInfoContent, attendanceContent);
        });

        // --- Attendance Section Logic ---
        const semesterSelect = document.getElementById('semester-select');
        const subjectListContainer = document.getElementById('subject-list-container');
        const subjectListDiv = document.getElementById('subject-list');
        const semesterView = document.getElementById('semester-view');
        const subjectDetailView = document.getElementById('subject-detail-view');
        const backToSubjectsBtn = document.getElementById('back-to-subjects');


        // Mock data for subjects and their attendance
        const subjectsBySemester = {
            sem1: [
                { name: 'Calculus', total: 30, present: 28 },
                { name: 'Chemistry', total: 25, present: 22 },
                { name: 'Physics', total: 28, present: 28 },
                { name: 'C++', total: 20, present: 15 },
            ],
            sem2: [
                { name: 'Data Structures', total: 32, present: 30 },
                { name: 'Digital Logic Design', total: 28, present: 25 },
                { name: 'Linear Algebra', total: 30, present: 29 },
                { name: 'Communication Skills', total: 18, present: 17 },
            ],
            sem3: [
                { name: 'Database Management', total: 35, present: 30 },
                { name: 'Operating Systems', total: 33, present: 33 },
                { name: 'Computer Networks', total: 30, present: 25 },
                { name: 'Software Engineering', total: 25, present: 22 },
            ]
        };

        function resetDashboardStats() {
            document.getElementById('total-classes-dashboard').textContent = '--';
            document.getElementById('present-dashboard').textContent = '--';
            document.getElementById('absent-dashboard').textContent = '--';
            document.getElementById('rate-dashboard').textContent = '--';
        }

        function updateDashboardStats(semesterKey) {
            const subjects = subjectsBySemester[semesterKey];
            if (!subjects || subjects.length === 0) {
                resetDashboardStats();
                return;
            }

            const overallStats = subjects.reduce((acc, subject) => {
                acc.total += subject.total;
                acc.present += subject.present;
                return acc;
            }, { total: 0, present: 0 });

            const absent = overallStats.total - overallStats.present;
            const rate = overallStats.total > 0 ? ((overallStats.present / overallStats.total) * 100).toFixed(1) + '%' : 'N/A';

            document.getElementById('total-classes-dashboard').textContent = overallStats.total;
            document.getElementById('present-dashboard').textContent = overallStats.present;
            document.getElementById('absent-dashboard').textContent = absent;
            document.getElementById('rate-dashboard').textContent = rate;
        }


        semesterSelect.addEventListener('change', () => {
            const selectedSemester = semesterSelect.value;

            // Update dashboard stats based on selection
            if (selectedSemester) {
                updateDashboardStats(selectedSemester);
            } else {
                resetDashboardStats();
            }

            // Show/hide subject list
            if (selectedSemester && subjectsBySemester[selectedSemester]) {
                const subjects = subjectsBySemester[selectedSemester];
                subjectListDiv.innerHTML = subjects.map(subject =>
                    `<a href="#" class="block p-3 bg-gray-50 hover:bg-indigo-100 rounded-md transition-colors duration-200" data-subject='${JSON.stringify(subject)}'>${subject.name}</a>`
                ).join('');
                subjectListContainer.classList.remove('hidden');

                // Add event listeners to the new subject links
                document.querySelectorAll('#subject-list a').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const subjectData = JSON.parse(e.currentTarget.dataset.subject);
                        showSubjectDetails(subjectData);
                    });
                });

            } else {
                subjectListContainer.classList.add('hidden');
            }
        });

        function showSubjectDetails(subject) {
            semesterView.classList.add('hidden');
            subjectDetailView.classList.remove('hidden');

            const absent = subject.total - subject.present;
            const rate = subject.total > 0 ? ((subject.present / subject.total) * 100).toFixed(1) + '%' : 'N/A';

            document.getElementById('subject-title').textContent = subject.name;
            document.getElementById('total-classes').textContent = subject.total;
            document.getElementById('present-classes').textContent = subject.present;
            document.getElementById('absent-classes').textContent = absent;
            document.getElementById('attendance-rate').textContent = rate;
        }

        backToSubjectsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            subjectDetailView.classList.add('hidden');
            semesterView.classList.remove('hidden');
        });


        // --- Image Upload by Camera Logic ---
        const startCameraButton = document.getElementById('start-camera');
        const takePhotoButton = document.getElementById('take-photo');
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('canvas');
        const capturedImageElement = document.getElementById('captured-image');
        const cameraStatusElement = document.getElementById('camera-status');
        const uploadContainer = document.getElementById('upload-container');
        const successMessage = document.getElementById('success-message');
        let stream = null;
        let isPhotoUploaded = false; // State to track if photo has been taken

        startCameraButton.addEventListener('click', async () => {
            if (isPhotoUploaded) return; // Don't do anything if photo is already uploaded

            cameraStatusElement.textContent = '';
            // Stop any existing stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = stream;
                takePhotoButton.disabled = false;
                startCameraButton.textContent = 'Restart Camera';
                // Set canvas dimensions once video metadata is loaded
                videoElement.addEventListener('loadedmetadata', () => {
                    canvasElement.width = videoElement.videoWidth;
                    canvasElement.height = videoElement.videoHeight;
                });
            } catch (err) {
                console.error("Error accessing camera: ", err);
                cameraStatusElement.textContent = 'Error: Could not access the camera. Please check permissions.';
                takePhotoButton.disabled = true;
            }
        });

        takePhotoButton.addEventListener('click', () => {
            if (stream && videoElement.readyState >= 2) { // Check if video has enough data
                const context = canvasElement.getContext('2d');
                context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);

                const imageDataUrl = canvasElement.toDataURL('image/png');
                capturedImageElement.src = imageDataUrl;

                // Stop the camera stream after taking a photo
                stream.getTracks().forEach(track => track.stop());
                videoElement.srcObject = null;

                // --- LOCK THE FEATURE & UPDATE UI ---
                isPhotoUploaded = true;

                // Hide the buttons and the live feed
                document.getElementById('photo-buttons').classList.add('hidden');
                document.getElementById('live-feed-container').classList.add('hidden');
                cameraStatusElement.classList.add('hidden');

                // Adjust grid to center the captured photo
                const photoGrid = document.getElementById('photo-grid');
                photoGrid.classList.remove('md:grid-cols-2');
                photoGrid.classList.add('justify-center');

                // Show the success message
                successMessage.classList.remove('hidden');
            }
        });

    </script>
</body>

</html>
